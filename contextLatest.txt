=== Log Entry: 2025-12-10T17:17:27 ===

ISSUE: Shopify API Initialization Build Error
- Error: "Cannot initialize Shopify API Library. Missing values for: apiSecretKey, hostName, apiKey"
- Location: /api/hello route build failure
- Root Cause: Shopify API was being initialized at module load time with empty fallback strings when env vars are missing

FIX APPLIED:
1. Modified `web/lib/shopify/initialize-context.ts`:
   - Changed from eager module-level initialization to lazy singleton pattern
   - API now only initializes when first accessed via `getShopify()` function
   - Added proper error handling with descriptive message for missing env vars

2. Updated all consuming files to call `getShopify()` function:
   - `web/lib/shopify/verify.ts`
   - `web/lib/shopify/register-webhooks.ts`
   - `web/lib/shopify/gdpr.ts`
   - `web/lib/get-products.ts`
   - `web/app/api/webhooks/route.ts`

RESULT: Build now succeeds âœ“
- Compiled successfully in 24.7s
- All routes generated correctly including /api/hello and /api/webhooks

=== Log Entry: 2025-12-11T14:11:57 ===

PLANNING: WhatsApp Order Notification via Evolution API

REQUIREMENT:
- Listen for Shopify order creation webhook
- Extract customer phone, name, order items, total, tags
- Send WhatsApp message via Evolution API

FILES TO CREATE:
1. web/lib/evolution-api.ts - Evolution API service
2. web/app/api/webhooks/orders/route.ts - Order webhook handler

FILES TO MODIFY:
1. web/lib/shopify/register-webhooks.ts - Add ORDERS_CREATE handler

ENV VARS NEEDED:
- EVOLUTION_API_URL
- EVOLUTION_API_KEY
- EVOLUTION_INSTANCE

STATUS: Awaiting user approval on implementation plan

=== Log Entry: 2025-12-11T15:25:21 ===

PHASE 1 and 2 COMPLETE: Created Evolution API Service

FILE CREATED: web/lib/evolution-api.ts
- formatPhoneForEvolution() - strips + prefix, validates 10-15 digits
- buildOrderMessage() - creates WhatsApp message with order details
- sendOrderNotification() - POSTs to Evolution API with instanceName

NEXT: Phase 3 - Create order webhook endpoint

=== Log Entry: 2025-12-11T15:30:24 ===

PHASE 3 COMPLETE: Created Order Webhook Endpoint

FILE CREATED: web/app/api/webhooks/orders/route.ts
- Receives Shopify ORDER_CREATE webhooks
- Extracts: phone, firstName, items, vendors, totalPrice, currency
- Calls sendOrderNotification() from evolution-api.ts
- Returns 500 on failure (allows Shopify retry)
- Returns 200 on success or if no phone number

NEXT: Phase 4 - Register ORDERS_CREATE webhook

=== Log Entry: 2025-12-11T15:33:18 ===

PHASE 4 COMPLETE: Registered ORDERS_CREATE Webhook

FILE MODIFIED: web/lib/shopify/register-webhooks.ts
- Added ORDERS_CREATE handler in addHandlers() function
- Points to /api/webhooks/orders endpoint
- Matches exact diff from implementation plan

NEXT: Phase 5 - Build & Deploy

=== Log Entry: 2025-12-11T15:35:31 ===

PHASE 5: Build & Deploy

LOCAL BUILD SKIPPED:
- PowerShell execution policy prevents npm/pnpm from running
- Will verify build on Vercel instead

USER ACTION REQUIRED:
- Deploy to Vercel
- Monitor build logs for any errors
- If build succeeds, proceed to Phase 6 (Testing)
